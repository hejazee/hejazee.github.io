<!doctype html><html lang="fa" dir="rtl"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-HTH8HV1F9Z"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-HTH8HV1F9Z', { 'anonymize_ip': false });
}
</script><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="geo.region" content="IRAN"><link rel="canonical" href="https://hejazee.ir/posts/1390/08/%D8%A7%DB%8C%D8%AC%D8%A7%D8%AF-%D8%A8%D9%84%D9%88%DA%A9-%D8%AA%D9%88%D8%B3%D8%B7-%D9%85%D8%A7%DA%98%D9%88%D9%84-%D9%86%D9%88%DB%8C%D8%B3%DB%8C/"><link rel="shortcut icon" href="/favicon.ico" type="image/png"><title>ایجاد بلوک توسط ماژول نویسی | وبلاگ رسمی احمد حجازی</title><link rel="stylesheet" href="/lib/bootstrap-5.1.3-dist/css/bootstrap.rtl.min.css"><link rel="stylesheet" href="/lib/fontawesome-free-5.15.2-web/css/all.min.css"><link rel="stylesheet" href="/fonts/fonts.css"><link rel="stylesheet" href="/scss/index.172bdd1266bb92eb39450b3215cc97ecd4d7ec43ae649679fe3140f189d01c32.css" integrity="sha256-FyvdEma7kus5RQsyFcyX7NTX7EOuZJZ5/jFA8YnQHDI=" crossorigin="anonymous"></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-dark" id="farsaran-header-nav"><div class="container"><a class="navbar-brand order-0 flex-grow-1 flex-lg-grow-0" href="/"><img src="/logo.svg" alt="وبلاگ رسمی احمد حجازی" height="34"></a>
<button class="navbar-toggler order-2 order-lg-1" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="نمایش منو">
<span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse mb-3 mb-lg-0" id="navbarSupportedContent"><ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item"><a class="nav-link" href="/contact/">تماس</a></li><li class="nav-item"><a class="nav-link" href="/about/">درباره</a></li></ul></div></div></nav><div class="container mt-4"><div class="row"><div class="col-md-9"><header><h1 class="post-title fw-bold fs-2"><a class="text-dark" href="/posts/1390/08/%D8%A7%DB%8C%D8%AC%D8%A7%D8%AF-%D8%A8%D9%84%D9%88%DA%A9-%D8%AA%D9%88%D8%B3%D8%B7-%D9%85%D8%A7%DA%98%D9%88%D9%84-%D9%86%D9%88%DB%8C%D8%B3%DB%8C/">ایجاد بلوک توسط ماژول نویسی</a></h1></header><small class="d-block text-secondary post-date">ارسال شده در
<time datetime="2011-10-30">Oct 30, 2011</time></small><article class="blog-post" role="article" typeof="schema:Article"><p>برای ایجاد بلوک در دروپال دو راه وجود دارد:</p><ol><li>ایجاد بلوک در صفحه ی مدیریت بلوک ها (admin/build/blocks) که به این نوع بلوک ها، <em>بلوک های سفارشی</em> می گویند</li><li>ایجاد بلوک توسط برنامه نویسی در ماژول ها (که به این نوع بلوک ها، بلوک های default می گویند)</li></ol><p>برای ایجاد یک بلوک توسط ماژول، باید هوک block را در ماژول تعریف کنیم. طریقه ی تعریف هوک block به صورت زیر است:</p><p class="important-def" dir="ltr">function hook_block($op = 'list', $delta = 0, $edit = array())</p><p>این تابع، دارای 3 تا آرگومان است که در زیر هر یک از آن ها را توضیح می دهم.</p><h2>آرگومان $op</h2><p>دروپال هنگامی که می خواهد در خصوص بلوک ها کاری انجام دهد یا اطلاعاتی به دست بیاورد، هوک block را اجرا می کند. و بسته به این که چه کاری می خواهد انجام دهد و چه اطلاعاتی را می خواهد دریافت کند، مقدار متفاوتی را به آرگومان $op ارسال می کند.</p><p>در زیر مقادیری که ممکن است به $op ارسال شود را لیست می کنم:</p><table border="0"><caption>مقادیر آرگومان $op</caption><tbody><tr><th>مقدار آرگومان</th><th>شرح</th></tr><tr><td>'list'</td><td>هنگامی که دروپال می خواهد لیست همه ی بلوک ها را به دست آورد، این مقدار را استفاده می کند.</td></tr><tr><td>'configure'</td><td>&nbsp;هنگامی که دروپال صفحه ی تنظیمات یک بلوک را می خواهد نمایش دهد.</td></tr><tr><td>'save'</td><td>&nbsp;هنگامی که صفحه ی تنظیمات یک بلوک submit شده و دروپال می خواهد تنظیمات ارسال شده را ذخیره کند.</td></tr><tr><td>'view'</td><td>&nbsp;هنگامی که دروپال می خواهد یک بلوک را نمایش دهد.</td></tr></tbody></table><p>بنابر این، باید در تعریف هوک block، بررسی کنیم که آرگومان $op چه مقداری دارد. تا به این وسیله بفهمیم که دروپال از این هوک چه انتظاری دارد و کار مورد نظر را انجام دهیم.<br>برای این منظور، معمولا باید یک دستور switch را به کار ببریم و مقادیر $op را در آن تست کنیم:</p><p dir="ltr">function MYMODULE_block($op = 'list', $delta = 0, $edit = array()) {<br>&nbsp; switch ($op) {<br>&nbsp;&nbsp;&nbsp; case 'list':<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>&nbsp;&nbsp;&nbsp; case 'configure':<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>&nbsp;&nbsp;&nbsp; case 'save':<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>&nbsp;&nbsp;&nbsp; case 'view':<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>&nbsp; }<br>}</p><h3>1 - لیست کردن بلوک ها ('list')</h3><p>هنگامی که دروپال می خواهد لیست بلوک ها را به دست آورد، هوک block را با آرگومان $op و مقدار 'list' فراخوانی می کند. در این حالت، هوک block باید یک آرایه برگرداند که شامل لیست بلوک هایی که قرار است تعریف کنیم باشد.<br>این آرایه، یک آرایه ی تو در تو کلید/مقدار است. کلید ها در این آرایه $delta می باشند (یک شناسه ی منحصر به فرد بین تمام بلوک هایی که این ماژول تعریف می کند)<br>مقادیر هر کلید در این آرایه، خود یک آرایه کلید/مقدار دیگر است که خصوصیات بلوک را مشخص می کند. کلید های زیر وجود دارند:</p><ul><li>'info'<br>این مقدار ضروری است. و یک مقدار ترجمه شده است که در صفحه ی مدیریت بلوک ها برای عنوان بلوک به مدیر سایت نشان داده می شود.</li><li>'cache'<br>چگونگی cache شدن بلوک را مشخص می کند. مقادیر زیر وجود دارد:<br><ul><li>BLOCK_NO_CACHE : بلوک اصلا cache نشود.</li><li>BLOCK_CACHE_PER_ROLE : بلوک برای هر نقش کاربری به صورت جداگانه cache شود.</li><li>BLOCK_CACHE_PER_USER : بلوک برای هر کاربر عضو سایت جداگانه cache شود (برای سایت هایی که تعداد زیادی کاربر دارد توصیه نمی شود.)</li><li>BLOCK_CACHE_PER_PAGE : بلوک برای هر صفحه از سایت جداگانه cache شود.</li><li>BLOCK_CACHE_GLOBAL : بلوک برای کل سایت و همه ی اعضا، فقط یک بار cache شود.</li></ul></li><li>'status'<br>مشخص می کند که آیا بلوک به طور پیش فرض (بعد از فعال شدن ماژول ما) فعال باشد یا خیر (TRUE یا FALSE) مقدار پیش فرض FALSE است.</li><li>'region'<br>ناحیه ی پیش فرضی که بلوک در آن قرار میگیرد. البته بلوک می تواند بعدا توسط مدیریت سایت به یک ناحیه دیگر منتقل شود. این مقدار فقط به شرطی موثر است که status هم برابر TRUE باشد؛ اگر بلوک غیر فعال باشد، region برابر با 'None' قرار میگیرد.<br>توجه کنید که نام region ها (ناحیه ها) بستگی به theme سایت دارد.</li><li>'weight'<br>مشخص کننده ی ترتیب چینش بلوک ها در یک ناحیه می باشد. هرچه weight بیشتر باشد، بلوک سنگین تر می شود و در راستای عمودی به سمت پایین می آید و در راستای افقی به سمت راست متمایل می شود. (البته خیلی هم ربطی به راست و چپ و بالا و پایین ندارد. منظور این است که هرچه weight بیشتر باشد، بلوک دیرتر render می شود و در سورس HTML صفحه، بلوک پایین تر می آید. موقعیت ظاهری بلوک به عوامل دیگری مثل css و ... هم بستگی دارد)<br>مقدار پیش فرض weight برابر صفر است.</li><li>'pages'<br>مشخص می کند که به طور پیش فرض، بلوک در چه صفحاتی باید قابل رویت باشد. مقدار پیش فرض آن یک رشته ی تهی "" است.<br>این مقدار، باید شامل مسیر های دروپالی باشد که با کاراکتر جداکننده ی خط از هم جدا شده اند. کاراکتر * یک wildcard است. به عنوان نمونه مسیر های زیر را مثال می زنم:<br>'blog' برای صفحه ی اصلی وبلاگ (?q=blog) و 'blog/*' برای همه ی صفحات وبلاگ های شخصی.<br>'&lt;front>' برای صفحه ی اصلی به کار می رود. برای اطلاعات بیشتر به مستندات تابع drupal_match_path() مراجعه کنید.</li><li>'custom'<br>TRUE یعنی این یک بلوک سفارشی است و FALSE یعنی این بلوک توسط یک ماژول ایجاد شده است. (؟؟)</li><li>'title'<br>عنوان پیش فرض بلوک (؟؟)</li></ul><h3>2 - تنظیمات اختصاصی بلوک ('configure')</h3><p>هنگامی که دروپال می خواهد فرم پیکربندی تنظیمات بلوک را نمایش دهد، هوک block را با آرگومان $op و مقدار 'configure' فراخوانی می کند.<br>در این حالت، در هوک block باید یک آرایه برگردانیم که تعریف فرم تنظیمات بلوک است. این آرایه از نوع form definition array می باشد (به مستندات Form API یا FAPI مراجعه کنید)<br>مقداری که در این جا برگردانده می شود، با فرم پیش فرض تنظیمات بلوک ترکیب می شود و به این ترتیب به ما اجازه می دهد که فرم تنظیمات بلوک را گسترش دهیم و عناصر مورد نظر مان را به آن اضافه کنیم.<br>هنگامی که فرم تنظیمات بلوک را گسترش می دهید، لازم دارید که کد لازم برای ذخیره ی تنظیمات بلوک را نیز در $op='save' بنویسید. (قسمت زیر را ببینید.)</p><h3>3 - ذخیره کردن تنظیمات اختصاصی بلوک ('save')</h3><p>هنگامی که فرم پیکربندی تنظیمات اختصاصی بلوک submit می شود و دروپال می خواهد تنظیمات را ذخیره کند، هوک block با آرگومان $op و مقدار 'save' فراخوانی می شود.<br>در این حالت، باید مقادیر ارسال شده از فرم پیکربندی بلوک را (که توسط عملیات configure ایجاد کردیم) ذخیره کنیم. این مقادیر در آرگومان $edit وجود دارند.<br>در این عملیات 'save' ، لازم نیست چیزی را برگردانیم.</p><h3>4 - نمایش بلوک ('view')</h3><p>هنگامی که دروپال می خواهد یک بلوک را به کاربر نمایش دهد، هوک block را با آرگومان $op و مقدار 'view' فراخوانی می کند.<br>در این عملیات، باید یک آرایه شامل title و content بلوک را برگردانیم.</p><h2>آرگومان $delta</h2><p>از آن جایی که هر ماژولی می تواند چند تا بلوک را تعریف کند، یک شناسه ی منحصر به فرد به نام $delta وجود دارد که وجه تمایز بلوک های ایجاد شده توسط یک ماژول است. مثلا ماژول MyModule می تواند 2 تا بلوک تعریف کند که دلتای بلوک اولی برابر 'first' و دلتای بلوک دومی برابر 'second' باشد<br>هنگامی که دروپال هوک block را با هر یک از مقادیر $op زیر فراخوانی می کند:</p><p dir="ltr">$op = 'configure'<br>$op = 'save'<br>$op = 'view'</p><p>آرگومان $delta مشخص می کند که این عملیاتی که دارد انجام می گیرد، در مورد کدام بلوک می باشد.<br>مثلا در مثال قبلی، هنگامی که تنظیمات بلوک 'first' در حال ذخیره شدن است، هوک block با آرگومان $op برابر 'save' و آرگومان $delta با مقدار 'first' فراخوانی می شود.</p><p>توجه کنید که هنگامی که آرگومان $op برابر 'list' است، مقدار آرگومان $delta نادیده گرفته می شود و اهمیتی ندارد. زیرا عملیات 'list' خودش دارد بلوک ها و delta ی آن ها را تعریف می کند.</p><h2>آرگومان $edit</h2><p>هنگامی که آرگومان $op بربر 'save' است (در عملیات save قرار داریم) ، آرگومان $edit شامل مقادیر ارسال شده توسط فرم پیکربندی بلوک می باشد. (به مستندات FAPI مراجعه شود.)</p><h5>مطالب مرتبط:</h5><ul><li></li><li></li></ul></article></div><aside class="col-md-3 mt-4"><h3>Monthly Archive</h3><ul><li><a href="/month/1395-06/" title="All posts from 1395-06">1395-06</a> (1)</li><li><a href="/month/1395-01/" title="All posts from 1395-01">1395-01</a> (1)</li><li><a href="/month/1394-12/" title="All posts from 1394-12">1394-12</a> (3)</li><li><a href="/month/1394-08/" title="All posts from 1394-08">1394-08</a> (1)</li><li><a href="/month/1394-07/" title="All posts from 1394-07">1394-07</a> (1)</li><li><a href="/month/1394-03/" title="All posts from 1394-03">1394-03</a> (1)</li><li><a href="/month/1394-02/" title="All posts from 1394-02">1394-02</a> (1)</li><li><a href="/month/1393-12/" title="All posts from 1393-12">1393-12</a> (1)</li><li><a href="/month/1393-07/" title="All posts from 1393-07">1393-07</a> (1)</li><li><a href="/month/1393-06/" title="All posts from 1393-06">1393-06</a> (2)</li><li><a href="/month/1393-05/" title="All posts from 1393-05">1393-05</a> (2)</li><li><a href="/month/1393-04/" title="All posts from 1393-04">1393-04</a> (4)</li><li><a href="/month/1393-03/" title="All posts from 1393-03">1393-03</a> (5)</li><li><a href="/month/1393-02/" title="All posts from 1393-02">1393-02</a> (1)</li><li><a href="/month/1393-01/" title="All posts from 1393-01">1393-01</a> (4)</li><li><a href="/month/1392-12/" title="All posts from 1392-12">1392-12</a> (5)</li><li><a href="/month/1392-10/" title="All posts from 1392-10">1392-10</a> (5)</li><li><a href="/month/1392-06/" title="All posts from 1392-06">1392-06</a> (1)</li><li><a href="/month/1392-04/" title="All posts from 1392-04">1392-04</a> (1)</li><li><a href="/month/1392-02/" title="All posts from 1392-02">1392-02</a> (1)</li><li><a href="/month/1392-01/" title="All posts from 1392-01">1392-01</a> (5)</li><li><a href="/month/1391-11/" title="All posts from 1391-11">1391-11</a> (5)</li><li><a href="/month/1391-10/" title="All posts from 1391-10">1391-10</a> (4)</li><li><a href="/month/1391-09/" title="All posts from 1391-09">1391-09</a> (2)</li><li><a href="/month/1391-08/" title="All posts from 1391-08">1391-08</a> (3)</li><li><a href="/month/1391-07/" title="All posts from 1391-07">1391-07</a> (6)</li><li><a href="/month/1391-05/" title="All posts from 1391-05">1391-05</a> (1)</li><li><a href="/month/1391-04/" title="All posts from 1391-04">1391-04</a> (1)</li><li><a href="/month/1391-03/" title="All posts from 1391-03">1391-03</a> (2)</li><li><a href="/month/1391-02/" title="All posts from 1391-02">1391-02</a> (4)</li><li><a href="/month/1391-01/" title="All posts from 1391-01">1391-01</a> (6)</li><li><a href="/month/1390-12/" title="All posts from 1390-12">1390-12</a> (9)</li><li><a href="/month/1390-11/" title="All posts from 1390-11">1390-11</a> (8)</li><li><a href="/month/1390-10/" title="All posts from 1390-10">1390-10</a> (7)</li><li><a href="/month/1390-09/" title="All posts from 1390-09">1390-09</a> (4)</li><li><a href="/month/1390-08/" title="All posts from 1390-08">1390-08</a> (7)</li><li><a href="/month/1390-07/" title="All posts from 1390-07">1390-07</a> (14)</li><li><a href="/month/1390-06/" title="All posts from 1390-06">1390-06</a> (18)</li></ul></aside></div></div><footer id="footer-wrapper"><div id="footer-bottom-wrapper"><div class="container"><div class="row"><div class="col-12"><p dir="ltr">&copy; Copyright 2011-2022 * Ahmad Hejazee * All rights reserved.</p><small dir="ltr">Proudly Powered by Drupal 10 ;)</small></div></div></div></div></footer><script src="/lib/jQuery/jquery-3.6.0.min.js"></script>
<script src="/lib/bootstrap-5.1.3-dist/js/bootstrap.bundle.min.js"></script></body></html>