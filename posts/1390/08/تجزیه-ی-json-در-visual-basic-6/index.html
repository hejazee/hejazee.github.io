<!doctype html><html lang="fa" dir="rtl"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-HTH8HV1F9Z"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-HTH8HV1F9Z', { 'anonymize_ip': false });
}
</script><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="keywords" content="کار با JSON در ویژوال بیسیک,JSON,پروتکل,Protocol,Matrix,m4trix,Services,VBJSON,VB6,Visual Basic,ویژوال بیسیک,کلاینت,سرور,Microsoft Data Source Interfaces,msdatsrc.tlb,Microsoft Scripting Runtime,scrrun.dll,Microsoft ActiveX Data Objects 2.5 Library,msado25.tlb,ClearParserErrore,GetParserErrors,parse,RStoJSON,StringTOJSON,toString,toUnicode,Dictionary , آموزش کامپیوتر,برنامه نویسی,VBScript,وی بی اسکریپت,دروپال,Drupal,آموزش برنامه نویسی, سیستم عامل,هک,امنیت,مقالات VBScript,فایل,وبگاه,قدم به قدم,مبتدی,حرفه ای,ترفند,بهترین,hejazee,hejazi"><meta name="geo.region" content="IRAN"><link rel="canonical" href="https://hejazee.ir/posts/1390/08/%D8%AA%D8%AC%D8%B2%DB%8C%D9%87-%DB%8C-json-%D8%AF%D8%B1-visual-basic-6/"><link rel="shortcut icon" href="/favicon.ico" type="image/png"><title>تجزیه ی JSON در Visual Basic 6 | وبلاگ رسمی احمد حجازی</title><link rel="stylesheet" href="/lib/bootstrap-5.1.3-dist/css/bootstrap.rtl.min.css"><link rel="stylesheet" href="/lib/fontawesome-free-5.15.2-web/css/all.min.css"><link rel="stylesheet" href="/fonts/fonts.css"><link rel="stylesheet" href="/scss/index.172bdd1266bb92eb39450b3215cc97ecd4d7ec43ae649679fe3140f189d01c32.css" integrity="sha256-FyvdEma7kus5RQsyFcyX7NTX7EOuZJZ5/jFA8YnQHDI=" crossorigin="anonymous"></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-dark" id="farsaran-header-nav"><div class="container"><a class="navbar-brand order-0 flex-grow-1 flex-lg-grow-0" href="/"><img src="/logo.svg" alt="وبلاگ رسمی احمد حجازی" height="34"></a>
<button class="navbar-toggler order-2 order-lg-1" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="نمایش منو">
<span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse mb-3 mb-lg-0" id="navbarSupportedContent"><ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item"><a class="nav-link" href="/contact/">تماس</a></li><li class="nav-item"><a class="nav-link" href="/about/">درباره</a></li></ul></div></div></nav><div class="container mt-4"><div class="row"><div class="col-md-9"><header><h1 class="post-title fw-bold fs-2"><a class="text-dark" href="/posts/1390/08/%D8%AA%D8%AC%D8%B2%DB%8C%D9%87-%DB%8C-json-%D8%AF%D8%B1-visual-basic-6/">تجزیه ی JSON در Visual Basic 6</a></h1></header><small class="d-block text-secondary post-date">ارسال شده در
<time datetime="2011-10-25">Oct 25, 2011</time></small><article class="blog-post" role="article" typeof="schema:Article"><p>اخیرا داشتم برنامه ای می نوشتم که نیازمند ارتباط دوطرفه بین کلاینت و سرور بود.<br>برای انجام این کار روش های مختلفی وجود داشت، ولی در نهایت تصمیم گرفتم که برنامه ی تحت کلاینت را با Visual Basic 6 بنویسم و قسمت تحت سرور را هم با php و تحت فریمورک <a href="http://drupal.org/">دروپال</a> برنامه نویسی کنم. به این ترتیب، امکانات برنامه و قابلیت توسعه پذیری آن در آینده بهبود پیدا می کرد.<br>در این مرحله لازم بود که یک پروتکل ارتباطی نیز تعریف کنم. در نسخه های قبلی برنامه پروتکل را خودم طراحی کرده بودم (برنامه ی سمت سرور را هم با ASP.NET نوشته بودم) ولی در نسخه ی جدید برنامه بهتر دیدم که از پروتکل REST و فرمت JSON استفاده کنم. زیرا دروپال یک ماژول دارد به نام <a href="http://drupal.org/project/services">Services</a> که این قسمت سمت سرور را بسیار عالی و تمیز انجام می دهد.</p><p>&nbsp;در این جا لازم بود که یک برنامه نیز برای تجزیه ی JSON در ویژوال بیسیک 6 داشته باشم. که خوشبختانه یک کتابخانه ی آماده برای این کار پیدا کردم و خیلی در وقت من صرفه جویی شد.<br>نام این کتابخانه VBJSON می باشد. در این مقاله قصد دارم طرز کار کردن و استفاده از <a href="http://www.ediy.co.nz/vbjson-json-parser-library-in-vb6-xidc55680.html" title="VB JSON">کتابخانه ی VBJSON</a> در ویژوال بیسیک 6 را توضیح دهم.</p><hr width="300"><p>قبل از هر چیز باید فایل فشرده را از آدرس زیر دانلود کنیم:<br>http://www.ediy.co.nz/vbjson-json-parser-library-in-vb6-xidc55680.html</p><p>که البته من آن را به این مطلب نیز ضمیمه کردم: <a href="http://www.hejazee.com/sites/www.hejazee.com/files/fields/field_tutorial_files/u1/VBJSON.zip" title="VBJSON">VBJSON</a></p><p>این فایل فشرده شامل یک برنامه ی نمونه نیز می باشد.</p><p>این کتابخانه در اصل از 3 تا فایل تشکیل شده است. دو تا کلاس و یک ماژول که عبارتند از:</p><ul><li>ماژول JSON.bas&nbsp; (این ماژول، قسمت اصلی کتابخانه است و در برنامه هایمان باید از این استفاده کنیم)</li><li>کلاس&nbsp; cJSONScript.cls&nbsp; (این کلاس شامل کد های لازم برای اجرا کردن JSON می باشد. به این معنی که JSON را به عنوان یک اسکریپت در نظر می گیرد و آن را اجرا می کند. در این مقاله به این کلاس نمی پردازم)</li><li>کلاس&nbsp;&nbsp; cStringBuilder.cls&nbsp; (این کلاس شامل یک سری متد هایی است که کار با رشته ها را انجام می دهند. در واقع دلیل استفاده از این کلاس به جای توابع رشته ای درون ساخته ی ویژال بیسیک این است که، توابع درون ساخته ی ویژوال بیسیک بیش از حد کند هستند. اما این کلاس، با استفاده از توابع سطح پایین ویندوز و منطق پیشرفته ی خودش، توانسته به شکل قابل توجه ای کار کردن با رشته ها را سریع تر کند.<br>از آن جایی که پردازش JSON نیازمند کار زیاد با رشته ها میباشد، استفاده از این کلاس، سبب می شود که سرعت کار به شکل چشمگیری بهبود پیدا کند.)</li></ul><p>برای شروع کار، یک پروژه ی جدید در ویژوال بیسیک 6 ایجاد می کنیم و سه تا فایل فوق را در درون پوشه ی پروژه کپی می کنیم</p><p>اکنون باید این سه تا کلاس و ماژول را به ویژوال استودیو معرفی کنیم. برای منظور، کافی است که از منوی Project، گزینه ی Add Module (برای افزودن ماژول) و یا Add Class Module (برای افزودن کلاس) را کلیک کنیم و در پنجره ی باز شده، به زبانه ی Existing برویم و فایل مورد نظر را انتخاب و اضافه کنیم.<br>به این ترتیب، سه تا کلاس و ماژول را به پروژه اضافه می کنیم.</p><fieldset class="tip"><legend>توجه</legend>همچنین باید تعدادی کتابخانه را نیز به پروژه اضافه کنیم. برای این منظور از منوی Project گزینه ی References... را انتخاب می کنیم و موارد زیر را تیک می زنیم:<p dir="ltr"><strong>Microsoft Data Source Interfaces</strong><br><em>C:\Windows\system32\msdatsrc.tlb</em></p><p dir="ltr"><strong>Microsoft Scripting Runtime</strong><br><em>C:\Windows\system32\scrrun.dll</em></p><p dir="ltr"><strong>Microsoft ActiveX Data Objects 2.5 Library</strong><br><em>C:\Program Files\Common Files\system\ado\msado25.tlb</em></p></fieldset><p>اکنون وقت آن است که از کتابخانه ی VBJSON در برنامه مان استفاده کنیم.</p><p>موضوع اصلی مورد نظر ما، ماژول JSON.bas می باشد. این ماژول همان طور که در شکل می بینید، دارای چند تا متد و خصوصیت است:</p><p><img src="http://www.hejazee.com/sites/www.hejazee.com/files/fields/field_tutorial_images/u1/json.PNG" alt="متد های ماژول JSON" title="متد های ماژول JSON" style="float:left;padding:15px" width="240" height="163"></p><ul><li>ClearParserErrore</li><li>GetParserErrors</li><li>parse</li><li>RStoJSON</li><li>StringTOJSON</li><li>toString</li><li>toUnicode</li></ul><p style="clear:both">برای شروع کار، ابتدا حالتی را فرض می کنیم که یک رشته ی متنی شامل JSON را داریم و می خواهم آن را تجزیه کنیم و اشیاء موجود در آن را استخراج کنیم.<br>برای این کار، می بایست رشته ی مورد نظرمان را در درون یک متغیر داشته باشیم:</p><p style="clear:both" dir="ltr">Dim sInputJson As String<br>sInputJson = "{ width: '200', frame: false, height: 130, bodyStyle:'background-color: #ffffcc;',buttonAlign:'right', items: [{ xtype: 'form',&nbsp; url: '/content.asp'},{ xtype: 'form2',&nbsp; url: '/content2.asp'}] }"</p><p style="clear:both">سپس باید آن را به متد parse از ماژول JSON پاس کنیم:</p><pre class="brush: vb;fontsize: 100; first-line: 1;">Dim p As Object
' sets p
Set p = JSON.parse(sInputJson)
MsgBox "Parsed object output: " &amp; JSON.toString(p)
MsgBox "Get Bodystyle data: " &amp; p.Item("bodyStyle")
MsgBox "Get Form Url data: " &amp; p.Item("items").Item(1).Item("url")
p.Item("items").Item(1).Add "ExtraItem", "Extra Data Value"
MsgBox "Parsed object output with added item: " &amp; JSON.toString(p)</pre><p>متد JSON.parse یک آبجکت از نوع Dictionary را برمیگرداند که شامل JSON تجزیه شده است.</p><fieldset class="tip"><legend>نکته</legend>نوع Dictionary در کتابخانه ی Microsoft Scripting Runtime تعریف شده که در فایل C:\Windows\system32\scrrun.dll موجود است.</fieldset><p>همان طور که می بینید، می توانیم خروجی متد parse را در متغیری مثل p ذخیره کنیم و سپس از آن به طریق معمول Dictionary ها استفاده کنیم.<br>برای نمونه، کد JSON زیر را در نظر بگیرید:</p><pre class="brush: jscript;fontsize: 100; first-line: 1;">{
    width:  '200',
    frame:  false,
    height:  130,
    bodyStyle:'background-color:  #ffffcc;',
    buttonAlign:'right',
    items:  [
        {
            xtype:  'form',
            url:  '/content.asp'
        },
        {
            xtype:  'form2',
            url:  '/content2.asp'
        }
    ]
}</pre><p>هنگامی که کد JSOn فوق را به کمک متد JSON.parse تجزیه می کنیم و در متغیر p ذخیره می کنیم، می توان به اجزای این آبجکت JSON به روش زیر دسترسی داشت:<br>مثلا می خواهیم مقدار خاصیت width را به دست آوریم:</p><p dir="ltr">p.Item("width")</p><p>همچنین، مقدار p.Item("items") خودش یک Dictionart دیگر است و می توان به اجزا آن به صوت تو در تو دسترسی داشت:</p><p dir="ltr">p.Item("items").Item(1).Item("url")</p><p>نکته ی حائز اهمیت در این جا این است که برای دسترسی به مقادیر خصوصیت های اشیا، کافی است که نام خصوصیت را به متد Item ارسال کنیم. ولی برای دسترسی به مقادیر موجود در آرایه ها باید شماره ی ایندکس آرایه را ارسال کنیم. که شمارش ایندکس آرایه از 1 شروع می شود.</p><fieldset class="tip"><legend>نکته: سایر متد های Dictionary</legend><p>آبجکت Dictionary که از تجزیه کردن JSON به دست می آید، دارای متد های متعددی است. که می توان به متد Add اشاره کرد.<br>به این روش می توان JSON را که پردازش کردیم، بر روی آن عملیات های مورد نظرمان را انجام دهیم و مثلا آبجکت ها یا خصوصیت های مورد نظرمان را به آن اضافه کنیم.<br>در نهایت هم می توانیم با متد JSON.toString آن را دوباره به فرمت JSON در بیاوریم (متد فوق در زیر توضیح داده شده است.)</p><p dir="ltr">p.Item("items").Item(1).Add "ExtraItem", "Extra Data Value"<br>MsgBox "Parsed object output with added item: " & JSON.toString(p)</p><p dir="rtl">کد فوق، یک آیتم جدید به نام ExtraItem و مقدار Extra Data Value به دیکشنری اضافه می کند. سپس آن را با متد JSON.toString دوباره به فرمت JSON برگرداندیم.</p></fieldset><h2>متد GetParserErrors</h2><p>در صورتی که تجزیه گر (یعنی متد JSON.parse) با خطایی مواجه شده باشد، به کمک این متد، می توان توضیح خطای رخ داده را بدست آورد.</p><h2>متد ClearParserErrors</h2><p>&nbsp;خطا های موجود در بافر را پاک می کند</p><h2>متد JSON.toString</h2><p>این متد، یک دیکشنری (که حاصل از تجزیه ی JSON می باشد)، را دریافت می کند و آن را به صورت رشته ی JSON بر می گرداند.</p><p>--</p></article></div><aside class="col-md-3 mt-4"><h3>Monthly Archive</h3><ul><li><a href="/month/1395-06/" title="All posts from 1395-06">1395-06</a> (1)</li><li><a href="/month/1395-01/" title="All posts from 1395-01">1395-01</a> (1)</li><li><a href="/month/1394-12/" title="All posts from 1394-12">1394-12</a> (3)</li><li><a href="/month/1394-08/" title="All posts from 1394-08">1394-08</a> (1)</li><li><a href="/month/1394-07/" title="All posts from 1394-07">1394-07</a> (1)</li><li><a href="/month/1394-03/" title="All posts from 1394-03">1394-03</a> (1)</li><li><a href="/month/1394-02/" title="All posts from 1394-02">1394-02</a> (1)</li><li><a href="/month/1393-12/" title="All posts from 1393-12">1393-12</a> (1)</li><li><a href="/month/1393-07/" title="All posts from 1393-07">1393-07</a> (1)</li><li><a href="/month/1393-06/" title="All posts from 1393-06">1393-06</a> (2)</li><li><a href="/month/1393-05/" title="All posts from 1393-05">1393-05</a> (2)</li><li><a href="/month/1393-04/" title="All posts from 1393-04">1393-04</a> (4)</li><li><a href="/month/1393-03/" title="All posts from 1393-03">1393-03</a> (5)</li><li><a href="/month/1393-02/" title="All posts from 1393-02">1393-02</a> (1)</li><li><a href="/month/1393-01/" title="All posts from 1393-01">1393-01</a> (4)</li><li><a href="/month/1392-12/" title="All posts from 1392-12">1392-12</a> (5)</li><li><a href="/month/1392-10/" title="All posts from 1392-10">1392-10</a> (5)</li><li><a href="/month/1392-06/" title="All posts from 1392-06">1392-06</a> (1)</li><li><a href="/month/1392-04/" title="All posts from 1392-04">1392-04</a> (1)</li><li><a href="/month/1392-02/" title="All posts from 1392-02">1392-02</a> (1)</li><li><a href="/month/1392-01/" title="All posts from 1392-01">1392-01</a> (5)</li><li><a href="/month/1391-11/" title="All posts from 1391-11">1391-11</a> (5)</li><li><a href="/month/1391-10/" title="All posts from 1391-10">1391-10</a> (4)</li><li><a href="/month/1391-09/" title="All posts from 1391-09">1391-09</a> (2)</li><li><a href="/month/1391-08/" title="All posts from 1391-08">1391-08</a> (3)</li><li><a href="/month/1391-07/" title="All posts from 1391-07">1391-07</a> (6)</li><li><a href="/month/1391-05/" title="All posts from 1391-05">1391-05</a> (1)</li><li><a href="/month/1391-04/" title="All posts from 1391-04">1391-04</a> (1)</li><li><a href="/month/1391-03/" title="All posts from 1391-03">1391-03</a> (2)</li><li><a href="/month/1391-02/" title="All posts from 1391-02">1391-02</a> (4)</li><li><a href="/month/1391-01/" title="All posts from 1391-01">1391-01</a> (6)</li><li><a href="/month/1390-12/" title="All posts from 1390-12">1390-12</a> (9)</li><li><a href="/month/1390-11/" title="All posts from 1390-11">1390-11</a> (8)</li><li><a href="/month/1390-10/" title="All posts from 1390-10">1390-10</a> (7)</li><li><a href="/month/1390-09/" title="All posts from 1390-09">1390-09</a> (4)</li><li><a href="/month/1390-08/" title="All posts from 1390-08">1390-08</a> (7)</li><li><a href="/month/1390-07/" title="All posts from 1390-07">1390-07</a> (14)</li><li><a href="/month/1390-06/" title="All posts from 1390-06">1390-06</a> (18)</li></ul></aside></div></div><footer id="footer-wrapper"><div id="footer-bottom-wrapper"><div class="container"><div class="row"><div class="col-12"><p dir="ltr">&copy; Copyright 2011-2022 * Ahmad Hejazee * All rights reserved.</p><small dir="ltr">Proudly Powered by Drupal 10 ;)</small></div></div></div></div></footer><script src="/lib/jQuery/jquery-3.6.0.min.js"></script>
<script src="/lib/bootstrap-5.1.3-dist/js/bootstrap.bundle.min.js"></script></body></html>