<!doctype html><html lang="fa" dir="rtl"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-HTH8HV1F9Z"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-HTH8HV1F9Z', { 'anonymize_ip': false });
}
</script><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="geo.region" content="IRAN"><link rel="canonical" href="https://hejazee.ir/posts/1390/12/%D8%B3%D9%81%D8%A7%D8%B1%D8%B4%DB%8C-%D8%B3%D8%A7%D8%B2%DB%8C-%D8%B5%D9%81%D8%AD%D9%87%DB%8C-%D8%A7%DB%8C%D8%AC%D8%A7%D8%AF-%D9%85%D8%AD%D8%AA%D9%88%D8%A7-%D8%AF%D8%B1-%D8%AF%D8%B1%D9%88%D9%BE%D8%A7%D9%84/"><link rel="shortcut icon" href="/favicon.ico" type="image/png"><title>سفارشی سازی صفحه‌ی ایجاد محتوا در دروپال | وبلاگ رسمی احمد حجازی</title><link rel="stylesheet" href="/lib/bootstrap-5.1.3-dist/css/bootstrap.rtl.min.css"><link rel="stylesheet" href="/lib/fontawesome-free-5.15.2-web/css/all.min.css"><link rel="stylesheet" href="/fonts/fonts.css"><link rel="stylesheet" href="/scss/index.172bdd1266bb92eb39450b3215cc97ecd4d7ec43ae649679fe3140f189d01c32.css" integrity="sha256-FyvdEma7kus5RQsyFcyX7NTX7EOuZJZ5/jFA8YnQHDI=" crossorigin="anonymous"></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-dark" id="farsaran-header-nav"><div class="container"><a class="navbar-brand order-0 flex-grow-1 flex-lg-grow-0" href="/"><img src="/logo.svg" alt="وبلاگ رسمی احمد حجازی" height="34"></a>
<button class="navbar-toggler order-2 order-lg-1" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="نمایش منو">
<span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse mb-3 mb-lg-0" id="navbarSupportedContent"><ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item"><a class="nav-link" href="/contact/">تماس</a></li><li class="nav-item"><a class="nav-link" href="/about/">درباره</a></li></ul></div></div></nav><div class="container mt-4"><div class="row"><div class="col-md-9"><header><h1 class="post-title fw-bold fs-2"><a class="text-dark" href="/posts/1390/12/%D8%B3%D9%81%D8%A7%D8%B1%D8%B4%DB%8C-%D8%B3%D8%A7%D8%B2%DB%8C-%D8%B5%D9%81%D8%AD%D9%87%DB%8C-%D8%A7%DB%8C%D8%AC%D8%A7%D8%AF-%D9%85%D8%AD%D8%AA%D9%88%D8%A7-%D8%AF%D8%B1-%D8%AF%D8%B1%D9%88%D9%BE%D8%A7%D9%84/">سفارشی سازی صفحه‌ی ایجاد محتوا در دروپال</a></h1></header><small class="d-block text-secondary post-date">ارسال شده در
<time datetime="2012-03-15">Mar 15, 2012</time></small><article class="blog-post" role="article" typeof="schema:Article"><p>صفحه‌ی ایجاد محتوا در دروپال (یعنی صفحه‌ی node/add) جلوه‌‌ی چندان جذابی ندارد. در زیر تصویر صفحه‌ی ایجاد محتوا را به شکل پیش‌فرض آن در دروپال 6 مشاهده می‌کنید.</p><p><img src="http://www.hejazee.com/sites/www.hejazee.com/files/imagecache/Large/fields/field_tutorial_images/books/u1/node-add.png" alt="صفحه‌ی ایجاد محتوا در دروپال به صورت پیش فرض و بدون سفارشی‌سازی چندان جذاب به نظ" title="صفحه‌ی ایجاد محتوا در دروپال به صورت پیش فرض و بدون سفارشی‌سازی چندان جذاب به نظر نمی‌رسد." class="imagecache-Large"></p><p>به خصوص هنگامی که دروپال را برای یک مشتری بخواهیم نصب کنیم، زیاد جالب و مناسب نیست. برای حل این مشکل، نیز مانند مشکلات دیگر، دروپال همواره راه حلی درخور و مناسب ارائه می‌دهد.</p><p>در این مقاله قصد دارم روش بهینه سازی و زیبا سازی این صفحه را برای شما توضیح دهم.</p><p></p><p>این مقاله را هنگامی نوشتم که داشتم صفحه‌ی ایجاد محتوا را برای همین وبلاگ خودم (www.hejazee.com) سفارشی می‌کردم. زیرا تعداد Content type های موجود در این سایت زیاد می‌باشد. و لذا برای تفنن، این ایده را عملی کردم!</p><p>نتیجه‌ی کار ما در این مقاله، چیزی شبیه تصویر زیر خواهد بود:</p><p><img src="http://www.hejazee.com/sites/www.hejazee.com/files/imagecache/Large/fields/field_tutorial_images/books/u1/node-add_0.png" alt="صفحه‌ی ایجاد محتوا در دروپال اگر سفارشی سازی شود، می‌تواند بسیار زیباتر شود." title="صفحه‌ی ایجاد محتوا در دروپال اگر سفارشی سازی شود، می‌تواند بسیار زیباتر شود." class="imagecache-Large"></p><p>پیش از هر چیز باید بگویم که سفارشی سازی صفحات در دروپال در 99 درصد مواقع باید توسط پوسته انجام گیرد. و لذا این مقاله نیز مستثنی نیست و ما تلاش خواهیم کرد که پوسته‌مان را تغییر دهیم. و البته توضیحات ارائه شده در این قسمت ممکن است برای پوسته‌های مختلف، اندکی تفاوت داشته باشد، اما مطمئنا تفاوت عمده ای وجود نخواهد داشت.</p><p>نکته‌ی دیگر این که این روش برای دروپال 6 نوشته شده است و البته گمان می کنم که روی دروپال 7 هم کار کند ولی آزمایش نکرده ام. برای اطمینان به API دروپال 7 مراجعه کنید.</p><p>روش کار به این صورت است که قبل از هر چیز، باید فایل template.php را در پوسته‌ی سایتتان باز کنید.</p><p>نکته اینجاست که هر صفحه‌ای و همچنین هر چیز قابل نمایشی در دروپال، توسط لایه‌ی پوسته (theme layer) نه نمایش گذاشته می‌شود. و همه‌ی کد های HTML خروجی دروپال، توسط پوسته تولید می‌شود.</p><p>هر عنصری در دروپال که دارای خروجی HTML باشد، ماژول تولید کننده‌ی آن عنصر، برای تولید خروجی باید از یکی از دو روش زیر استفاده کند:</p><ol><li>یک تابع theme برای آن عنصر مذکور تعریف کند. که در این صورت، این تابع توسط توابع پوسته قابل Override کردن خواهد بود.</li><li>میتواند یک فایل .tpl.php تعریف کند که آن نیز توسط توابع و فایل های پوسته‌ی فعال قابل Override کردن خواهد بود.</li></ol><p>صفحه‌ی ایجاد محتوا (یعنی صفحه‌ی node/add) نیز توسط ماژول node (از ماژول‌های هسته‌ی دروپال) ایجاد شده است و برای تولید خروجی آن هم، یک تابع به نام <a href="http://api.drupal.org/api/drupal/modules%21node%21node.pages.inc/function/theme_node_add_list/6">theme_node_add_list()</a> تعریف کرده است.</p><p>بنابراین، ما برای این‌که خروجی این صفحه را تغییر دهیم، باید که تابع فوق را Override کنیم و مکان مناسب برای Override کردن این تابع نیز، فایل template.php در پوسته‌ی مورد نظرمان است.</p><p>بنا بر این، فایل template.php را باز کنید. باید تابعی تعریف کنید که می‌تواند هر یک از توابع زیر باشد: (MY_THEME نام پوسته است)</p><ul><li>MY_THEME_node_add_list()</li><li>phptemplate_node_add_list()</li></ul><p>در صورتی که یکی این توابع قبلا تعریف شده است، مجددا آن را تعریف نکنید.</p><p>نکته: تابع اولی اولویت بیشتری برای اجرا شدن دارد. لذا اگر تابع اولی تعریف شود، تابع دوم حتی اگر تعریف شده باشد نیز، استفاده نخواهد شد.</p><p>من تابع اولی را استفاده کردم.</p><p><span style="color:red"><strong>توجه مهم</strong></span>: این تابع یک آرگومان به نام $content دریافت می‌کند.</p><p>شکل تابع باید شبیه مثال زیر باشد:</p><pre class="brush: php;fontsize: 100; first-line: 1;">/** AHMAD:
 * Override theme_node_add_list()
 * This theme function is called to generate the contents of node/add page
 * 
 * Add node type's class to each list item
 */
function MY_THEME_node_add_list($content) {
  $output = '';
  if ($content) {
    $output = '<dl class="node-type-list">';
    foreach ($content as $item) {
<pre><code>  //The node type is not passed to this function, but I can get it from access
  //argument! which is something like array('create', 'node_type') !!
  $access_arguments = unserialize($item['access_arguments']);
  $node_type = $access_arguments[1];
  
  $output .= &quot;&lt;div class=\&quot;node-add-{$node_type}-wrapper node-add-item-wrapper\&quot;&gt;&quot;;
  $output .= &quot;&lt;div class=\&quot;node-add-{$node_type}-inner node-add-item-inner\&quot;&gt;&quot;;
  $output .= &quot;&lt;dt class=\&quot;node-add-{$node_type}\&quot;&gt;&quot;. l($item['title'], $item['href'], $item['localized_options']) .'&lt;/dt&gt;';      
  $output .= &quot;&lt;dd class=\&quot;node-add-{$node_type}\&quot;&gt;&quot;. _MY_THEME_word_trim(filter_xss_admin($item['description']), 25, TRUE) .'&lt;/dd&gt;';
  $output .= &quot;&lt;/div&gt;&lt;!-- /.node-add-{$node_type}-wrapper --&gt;&quot;;
  $output .= &quot;&lt;/div&gt;&lt;!-- /.node-add-{$node_type}-inner --&gt;&quot;;
}
$output .= '&lt;/dl&gt;&lt;div style=&quot;clear: both;&quot;&gt;&lt;/div&gt;';
</code></pre><p>}
return $output;
}</pre><p>هدف ما از تابع فوق این است که هر نوع محتوایی را در یک div قرار دهیم و یک کلاس به آن اختصاص دهیم. تا به این ترتیب، بتوان کنار هر یک از نوع های محتوا در صفحه‌ی ایجاد محتوا، یک تصویر قرار داد و استایل های متعدد به آن داد.</p><p>نکته‎ی قابل ذکر در تابع فوق این است که متغیر $content &ldquo;نام ماشینی&rdquo; نوع محتوا را در خود ذخیره نکرده است. لذا من برای بدست آوردن نام ماشینی نوع محتوا یک حقه به کار برده ام :)<br>به این صورت که از access arguments هر یک از لینک ها استفاده کرده ام. زیرا در access arguments نام ماشینی نوع محتوا وجود دارد (مثلا مجوز ایجاد صفحه، مجوز ایجاد story و &mldr;)</p><p>برای به دست آوردن نام نوع محتوا از کد زیر استفاده کرده ام که می بینید:</p><pre class="brush: php;fontsize: 100; first-line: 1;">$access_arguments = unserialize($item[&lsquo;access_arguments&rsquo;]);
$node_type = $access_arguments[1];</pre><p>سپس همان طور که می‌بینید، دور هر یک از جفت dt و dl دو عدد div قرار داده ام تا بتوانم به آن استایل بدهم.</p><p>نکته‌ی دیگری که حائز اهمیت است، این است که توضیحات هر نوع محتوا ممکن است طولانی باشد و در کادر جا نشود. برای این منظور، من از تابع دیگری به نام _MY_THEME_word_trim استفاده کردم.</p><p>این تابع، یک رشته را دریافت می کند و آن را کوتاه می‌کند و تحویل می‌دهد. در زیر تعریف آن را می‌بینید:</p><pre class="brush: php;fontsize: 100; first-line: 1;">/**</p>
<ul>
<li>Trim a string to a given number of words
*</li>
<li>@param $string</li>
<li>the original string</li>
<li>@param $count</li>
<li>the word count</li>
<li>@param $ellipsis</li>
<li>TRUE to add &ldquo;&hellip;&rdquo;</li>
<li>or use a string to define other character</li>
<li>@param $node</li>
<li>provide the node and we&rsquo;ll set the $node-&gt;</li>
<li></li>
<li>@return</li>
<li>trimmed string with ellipsis added if it was truncated</li>
<li></li>
<li>@see <a href="http://www.lullabot.com/articles/trim-a-string-to-a-given-word-count">http://www.lullabot.com/articles/trim-a-string-to-a-given-word-count</a>
<em>/
function _MY_THEME_word_trim($string, $count, $ellipsis = FALSE){
$words = explode(&rsquo; &lsquo;, $string);
if (count($words) &gt; $count){
array_splice($words, $count);
$string = implode(&rsquo; &lsquo;, $words);
if (is_string($ellipsis)){
$string .= $ellipsis;
}
elseif ($ellipsis){
$string .= &lsquo;…&rsquo;;
}
}
return $string;
}
</pre><p>پس از این که تغییرات فوق را در فایل template.php ایجاد کردیم، آن را ذخیره می کنیم و theme registry را پاک می کنیم. برای این منظور کافی است به صفحه‌ی Performence یا کارائی بروید و دکمه‌ی Clear All caches را کلیک کنید.</p><p>اکنون قسمت اصلی کار انجام شده است. فقط کافی است که قدری استایل CSS ایجاد کنید و صفحه تان را بیارایید. استایلی که می‌نویسید کاملا به خود شما بستگی دارد.</p><p>اما استایلی که من به کار بردم چیزی مشابه زیر است:</p><pre class="brush: css;fontsize: 100; first-line: 1;">/</em>*</li>
<li>Style the node/add page
*/
dl.node-type-list {</li>
</ul>
<p>}
dl.node-type-list dt {</p>
<p>}
dl.node-type-list dd {
margin-right: 50px;
}
dl.node-type-list div.node-add-item-inner {
border: 1px solid transparent;
border-radius: 3px;
-moz-border-radius: 3px;
-webkit-border-radius: 3px;
-khtml-border-radius: 3px;
-o-border-radius: 3px;
float: right;
height: 100px;
margin: 3px;
padding: 3px;
width: 295px;
background-repeat: no-repeat;
background-position: right center;
}
dl.node-type-list div.node-add-item-inner:hover {
border-color: #AAAAAA;
background-color: #eee;
}</p>
<p>dl.node-type-list div.node-add-tutorial-inner {
background-image: url(&ldquo;picture1.png&rdquo;);
}
dl.node-type-list div.node-add-simplenews-inner {
background-image: url(&ldquo;picture2.png&rdquo;);
}
dl.node-type-list div.node-add-book-inner {
background-image: url(&ldquo;picture3.png&rdquo;);
}
/* etc&hellip; . */</pre></p><h5>مطالب مرتبط:</h5><ul><li><a href="/posts/1390/09/%D8%AA%D8%BA%DB%8C%DB%8C%D8%B1-%D9%88%D8%B6%D8%B9%DB%8C%D8%AA-workflow-%D8%AF%D8%B1-%D8%A8%D8%B1%D9%86%D8%A7%D9%85%D9%87/">تغییر وضعیت workflow در برنامه</a></li><li></li></ul></article><div id="comments"><div id="disqus_thread"></div><script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hejazee" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div></div><aside class="col-md-3 mt-4"><h3>Monthly Archive</h3><ul><li><a href="/month/1395-06/" title="All posts from 1395-06">1395-06</a> (1)</li><li><a href="/month/1395-01/" title="All posts from 1395-01">1395-01</a> (1)</li><li><a href="/month/1394-12/" title="All posts from 1394-12">1394-12</a> (3)</li><li><a href="/month/1394-08/" title="All posts from 1394-08">1394-08</a> (1)</li><li><a href="/month/1394-07/" title="All posts from 1394-07">1394-07</a> (1)</li><li><a href="/month/1394-03/" title="All posts from 1394-03">1394-03</a> (1)</li><li><a href="/month/1394-02/" title="All posts from 1394-02">1394-02</a> (1)</li><li><a href="/month/1393-12/" title="All posts from 1393-12">1393-12</a> (1)</li><li><a href="/month/1393-07/" title="All posts from 1393-07">1393-07</a> (1)</li><li><a href="/month/1393-06/" title="All posts from 1393-06">1393-06</a> (2)</li><li><a href="/month/1393-05/" title="All posts from 1393-05">1393-05</a> (2)</li><li><a href="/month/1393-04/" title="All posts from 1393-04">1393-04</a> (4)</li><li><a href="/month/1393-03/" title="All posts from 1393-03">1393-03</a> (5)</li><li><a href="/month/1393-02/" title="All posts from 1393-02">1393-02</a> (1)</li><li><a href="/month/1393-01/" title="All posts from 1393-01">1393-01</a> (4)</li><li><a href="/month/1392-12/" title="All posts from 1392-12">1392-12</a> (5)</li><li><a href="/month/1392-10/" title="All posts from 1392-10">1392-10</a> (5)</li><li><a href="/month/1392-06/" title="All posts from 1392-06">1392-06</a> (1)</li><li><a href="/month/1392-04/" title="All posts from 1392-04">1392-04</a> (1)</li><li><a href="/month/1392-02/" title="All posts from 1392-02">1392-02</a> (1)</li><li><a href="/month/1392-01/" title="All posts from 1392-01">1392-01</a> (5)</li><li><a href="/month/1391-11/" title="All posts from 1391-11">1391-11</a> (5)</li><li><a href="/month/1391-10/" title="All posts from 1391-10">1391-10</a> (4)</li><li><a href="/month/1391-09/" title="All posts from 1391-09">1391-09</a> (2)</li><li><a href="/month/1391-08/" title="All posts from 1391-08">1391-08</a> (3)</li><li><a href="/month/1391-07/" title="All posts from 1391-07">1391-07</a> (6)</li><li><a href="/month/1391-05/" title="All posts from 1391-05">1391-05</a> (1)</li><li><a href="/month/1391-04/" title="All posts from 1391-04">1391-04</a> (1)</li><li><a href="/month/1391-03/" title="All posts from 1391-03">1391-03</a> (2)</li><li><a href="/month/1391-02/" title="All posts from 1391-02">1391-02</a> (4)</li><li><a href="/month/1391-01/" title="All posts from 1391-01">1391-01</a> (6)</li><li><a href="/month/1390-12/" title="All posts from 1390-12">1390-12</a> (9)</li><li><a href="/month/1390-11/" title="All posts from 1390-11">1390-11</a> (8)</li><li><a href="/month/1390-10/" title="All posts from 1390-10">1390-10</a> (7)</li><li><a href="/month/1390-09/" title="All posts from 1390-09">1390-09</a> (4)</li><li><a href="/month/1390-08/" title="All posts from 1390-08">1390-08</a> (7)</li><li><a href="/month/1390-07/" title="All posts from 1390-07">1390-07</a> (14)</li><li><a href="/month/1390-06/" title="All posts from 1390-06">1390-06</a> (18)</li></ul></aside></div></div><footer id="footer-wrapper"><div id="footer-bottom-wrapper"><div class="container"><div class="row"><div class="col-12"><p dir="ltr">&copy; Copyright 2011-2022 * Ahmad Hejazee * All rights reserved.</p><small dir="ltr">Proudly Powered by Drupal 10 ;)</small></div></div></div></div></footer><script src="/lib/jQuery/jquery-3.6.0.min.js"></script>
<script src="/lib/bootstrap-5.1.3-dist/js/bootstrap.bundle.min.js"></script></body></html>