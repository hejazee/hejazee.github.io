<!doctype html><html lang="fa" dir="rtl"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-HTH8HV1F9Z"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-HTH8HV1F9Z', { 'anonymize_ip': false });
}
</script><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="keywords" content="Apache,Userdir,آپاچی,پوشه ی کاربر,لینوکس,اوبونتو,Ubuntu,linux,how to enable userdir,فعال کردن پوشه ی اختصاصی کاربران"><meta name="geo.region" content="IRAN"><link rel="canonical" href="https://hejazee.ir/posts/1391/02/%DA%86%DA%AF%D9%88%D9%86%D9%87-apache-%D8%B1%D8%A7-%D8%AA%D9%86%D8%B8%DB%8C%D9%85-%DA%A9%D9%86%DB%8C%D9%85-%D8%AA%D8%A7-%D9%87%D8%B1-%DA%A9%D8%A7%D8%B1%D8%A8%D8%B1-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%AE%D9%88%D8%AF%D8%B4-%D9%BE%D9%88%D8%B4%D9%87%DB%8C-%D9%88%D8%A8-%D9%85%D8%AC%D8%B2%D8%A7-%D8%AF%D8%A7%D8%B4%D8%AA%D9%87-%D8%A8%D8%A7%D8%B4%D8%AF/"><link rel="shortcut icon" href="/favicon.ico" type="image/png"><title>چگونه Apache را تنظیم کنیم تا هر کاربر برای خودش پوشه‌ی وب مجزا داشته باشد؟ | وبلاگ رسمی احمد حجازی</title><link rel="stylesheet" href="/lib/bootstrap-5.1.3-dist/css/bootstrap.rtl.min.css"><link rel="stylesheet" href="/lib/fontawesome-free-5.15.2-web/css/all.min.css"><link rel="stylesheet" href="/fonts/fonts.css"><link rel="stylesheet" href="/scss/index.172bdd1266bb92eb39450b3215cc97ecd4d7ec43ae649679fe3140f189d01c32.css" integrity="sha256-FyvdEma7kus5RQsyFcyX7NTX7EOuZJZ5/jFA8YnQHDI=" crossorigin="anonymous"></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-dark" id="farsaran-header-nav"><div class="container"><a class="navbar-brand order-0 flex-grow-1 flex-lg-grow-0" href="/"><img src="/logo.svg" alt="وبلاگ رسمی احمد حجازی" height="34"></a>
<button class="navbar-toggler order-2 order-lg-1" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="نمایش منو">
<span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse mb-3 mb-lg-0" id="navbarSupportedContent"><ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item"><a class="nav-link" href="/contact/">تماس</a></li><li class="nav-item"><a class="nav-link" href="/about/">درباره</a></li></ul></div></div></nav><div class="container mt-4"><div class="row"><div class="col-md-9"><header><h1 class="post-title fw-bold fs-2"><a class="text-dark" href="/posts/1391/02/%DA%86%DA%AF%D9%88%D9%86%D9%87-apache-%D8%B1%D8%A7-%D8%AA%D9%86%D8%B8%DB%8C%D9%85-%DA%A9%D9%86%DB%8C%D9%85-%D8%AA%D8%A7-%D9%87%D8%B1-%DA%A9%D8%A7%D8%B1%D8%A8%D8%B1-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%AE%D9%88%D8%AF%D8%B4-%D9%BE%D9%88%D8%B4%D9%87%DB%8C-%D9%88%D8%A8-%D9%85%D8%AC%D8%B2%D8%A7-%D8%AF%D8%A7%D8%B4%D8%AA%D9%87-%D8%A8%D8%A7%D8%B4%D8%AF/">چگونه Apache را تنظیم کنیم تا هر کاربر برای خودش پوشه‌ی وب مجزا داشته باشد؟</a></h1></header><small class="d-block text-secondary post-date">ارسال شده در
<time datetime="2012-05-19">May 19, 2012</time></small><article class="blog-post" role="article" typeof="schema:Article"><p>(سیستم مورد بحث، Ubuntu 11 و Apache2 است. گرچه سایر سیستم ها هم مشابه اند.)</p><p>هنگامی که در لینوکس Apache و PHP را نصب می کنیم، فقط یک پوشه‌ی /var/www به وجود می آید که می توان در آن فایل های وب (فایل های php ) را قرار داد.</p><p>در مقاله‌ی قبلی توضیح دادم که چگونه با استفاده از VirtualHost ها چندین سایت متفاوت را میزبانی کنیم و برای هرکدام، پوشه های مختلفی را به عنوان پوشه ی root مشخص کنیم.</p><p>اما تصور کنید که می خواهیم برای هر کاربری در سیستم، یک پوشه ی وب اختصاص دهیم. به خصوص هنگامی که قصد داشته باشیم که سرور برای Web Hosting اشتراکی و تجاری تهیه کنیم، باید برای مشتریان، در سیستم User تعریف کنیم و برای هر کدام یک پوشه ی وب اختصاص دهیم.</p><p>اگر بخواهیم برای هر یک از مشتریان، یک VirtualHost ایجاد کنیم، ممکن است قدری کار سختی باشد!<br>یک روش بهتر این است که از ماژول UserDir در Apache استفاده کنیم.</p><p>به این ترتیب، می توان تنظیم کرد که هر کاربری، بتواند در پوشه ی Home خودش، یک پوشه به نام public_html یا htdocs ایجاد کند و فایل های وب اش را در آن جا قرار دهد. و دیگر نیازی به ساخت VirtualHost برای هر کاربر نخواهد بود.</p><p>آن گاه کاربران، برای این که به سایتشان دسترسی داشته باشند، می توانند آدرس IP ی سرور را در مرورگر وارد کنند و پس از آن نام کاربری خود را همراه با یک علامت ~ قرار دهند تا پوشه ی وب شان را ببینند.</p><p>مثلا کاربری به نام ahmad در سیستم، دارای پوشه ی home به آدرس /home/ahmad است و آدرس پوشه ی وب او هم به صورت زیر است:</p><p dir="ltr">/home/ahmad/public_html</p><p>و می تواند از طریق آدرس زیر، به فایل هایش در وب دسترسی داشته باشد:</p><p dir="ltr">http://12.34.56.78/~ahmad/</p><p>برای پیاده سازی این چنین سیستمی، اولین قدم این است که ماژول userdir را در Apache فعال کنیم. در Ubuntu دستور زیر را اجرا می کنیم:</p><p><pre class="brush: bash;fontsize: 100; first-line: 1;">
sudo a2enmod userdir
sudo service apache2 restart
</pre>سپس کافی است دستور Userdir را در فایل پیکربندی Apache بگنجانیم. در اوبونتو، من فایل /etc/apache2/httpd.conf را انتخاب می کنم:</p><p><pre class="brush: bash;fontsize: 100; first-line: 1;">
sudo vim /etc/apache2/httpd.conf
</pre>(این فایل، محلی است که در آن تنظیمات سفارشی آپاچی را قرار می دهیم)</p><h3><strong>دستور UserDir</strong></h3><p>دستور UserDir آدرس پوشه ای را مشخص می کند که فایل های کاربر باید در آن قرار گیرد. مقادیر مجاز برای این دستور عباتند از:</p><ol><li>آدرس یک پوشه و یا یک قالب مسیر (شامل wildcard) که آدرس پوشه ی کاربر را مشخص می کند.<br><ul><li>ممکن است که مسیر مشخص شده، با یک اسلش / شروع شود و یک مسیر مطلق باشد. در این صورت، آدرس پوشه ی کاربر عبارت خواهد بود از آدرس فوق، بعلاوه نام کاربر.</li><li>ممکن است مسیر مشخص شده با / شروع شود و شامل یک علامت * (Wildcard) باشد. در این صورت، نام کاربر به جای * قرار خواهد گرفت.</li><li>ممکن است مسیر مشخص شده با / شروع نشود (و Wildcard هم نداشته باشد). در این صورت، آدرس پوشه ی کاربر عبارت خواهد بود از آدرس پوشه ی Home آن کاربر بعلاوه آدرس مشخص شده.</li><li>یک آدرس وب که با http:// شروع می شود. در این صورت، کاربر به آن آدرس redirect خواهد شد.</li><li>چند تا مورد از موارد بالا که با space از هم جدا شده اند. در این صورت، اگر یکی از آن ها موجود نبود، از بعدی استفاده می شود.</li></ul></li><li>کلمه ی disabled که مشخص می کند UserDir برای تمام کاربران غیر فعال است. به جز کاربرانی که توسط دستور enabled به وضوح فعال شده باشند. (در زیر مطالعه کنید.)</li><li>کلمه ی disabled به همراه تعدادی نام کاربری. در این صورت، UserDir برای آن کاربران غیر فعال خواهد بود. حتی اگر توسط دستور enabled هم فعال شوند، قدرت disabled بیشتر از enabled است و UserDir برای آن کاربران غیر فعال خواهد بود.</li><li>کلمه ی enabled به همراه تعدادی نام کاربری. در این صورت، UserDir برای آن کاربران فعال خواهد بود. حتی اگر که UserDir به صورت عمومی غیر فعال باشد. اما اگر UserDir توسط دستور disabled برای آن کاربر خاص، غیر فعال باشد، قدرت diabled بر enabled می چربد.</li></ol><p><strong>مثال ها:</strong></p><p>فرض کنید که مرورگر، تقاضایی را به آدرس زیر ارسال کند:</p><p dir="ltr">http://www.foo.com/~bob/one/two.html</p><p dir="rtl">در این صورت اگر:</p><ul><li>UserDir public_html<br>آن گاه، آدرس URL فوق به صورت زیر ترجمه می‌شود:<br>~bob/public_html/one/two.html<br>که در آن ~bob آدرس پوشه ی home کاربری به نام bob است.</li><li>UserDir /usr/web<br>آن گاه، آدرس URL فوق به صورت زیر ترجمه می‌شود:<br>/usr/web/bob/one/two.html</li><li>UserDir /home/*/www<br>آن گاه، آدرس URL فوق به صورت زیر ترجمه می‌شود:<br>/home/bob/www/one/two.html<br>توجه کنید که * با نام کاربر جایگزین شد.</li><li>UserDir disabled<br>UserDir enabled ahmad ali<br>در این صورت، UserDir فقط برای کاربران ahmad و ali فعال خواهد بود.</li><li>UserDir enabled<br>UserDir disabled root jro fish<br>در این صورت UserDir برای همه فعال خواهد بود به جز root و jro و fish</li><li>UserDir http://www.foo.com/users<br>در این صورت، کاربر به آدرس زیر هدایت می شود:<br>http://www.foo.com/users/bob/one/two.html</li><li>UserDir http://www.foo.com/*/usr<br>در این صورت، کاربر به آدرس زیر هدایت می شود:<br>http://www.foo.com/bob/usr/one/two.html<br>توجه کنید که هنوز هم * با نام کاربری جایگزین می شود.</li><li>UserDir http://www.foo.com/~*/<br>در این صورت، کاربر به آدرس زیر هدایت می شود:<br>http://www.foo.com/~bob/one/two.html</li></ul><p>نکته ی امنیتی:<br>همواره توصیه می شود که UserDir برای root غیر فعال باشد.</p><p dir="ltr">UserDir disabled root</p><h3><strong>فعال کردن پوشه ی CGI برای کاربران:</strong></h3><p>کافی است از ساختار زیر استفاده کنیم. برای مثال می خواهیم پوشه ی cgi-bin برای هر کاربر محل اجرای CGI باشد:</p><p><pre class="brush: plain;fontsize: 100; first-line: 1;">
&lt;Directory /home/*/public_html/cgi-bin/&gt;
   Options ExecCGI
   SetHandler cgi-script
&lt;/Directory&gt;
</pre><strong>فعال کردن PHP برای کاربران:</strong></p><p>به طور پیش فرض، PHP در پوشه های UserDir غیر فعال است. دلیل آن هم این است که در فایل زیر، غیر فعال شده است:</p><p dir="ltr">/etc/apache2/mods-enabled/php5.conf</p><p>برای فعال کردن PHP در UserDir ها، فایل فوق را ویرایش کنید و خطوط زیر را پیدا کرده و پشت آن ها # قرار دهید:</p><p><pre class="brush: plain;fontsize: 100; first-line: 1;">
&lt;IfModule mod_userdir.c&gt;
    &lt;Directory /home/*/public_html&gt;
         php_admin_value engine Off
    &lt;/Directory&gt;
&lt;/IfModule&gt;</pre>سپس Apache را ریستارت کنید:</p><p><pre class="brush: bash;fontsize: 100; first-line: 1;">
sudo service apache2 reload
</pre></p><hr><p>منابع:</p><p>http://httpd.apache.org/docs/2.0/howto/public_html.html<br>http://httpd.apache.org/docs/2.0/mod/mod_userdir.html</p></article><div id="comments"><div id="disqus_thread"></div><script>
      window.disqus_config = function () { 
        this.language = "fa";
      };
      (function() {
          var d = document, s = d.createElement('script'); s.async = true;
          s.src = '//' + "hejazee" + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
      })();
    </script></div></div><aside class="col-md-3 mt-4"><h3>Monthly Archive</h3><ul><li><a href="/month/1395-06/" title="All posts from 1395-06">1395-06</a> (1)</li><li><a href="/month/1395-01/" title="All posts from 1395-01">1395-01</a> (1)</li><li><a href="/month/1394-12/" title="All posts from 1394-12">1394-12</a> (3)</li><li><a href="/month/1394-08/" title="All posts from 1394-08">1394-08</a> (1)</li><li><a href="/month/1394-07/" title="All posts from 1394-07">1394-07</a> (1)</li><li><a href="/month/1394-03/" title="All posts from 1394-03">1394-03</a> (1)</li><li><a href="/month/1394-02/" title="All posts from 1394-02">1394-02</a> (1)</li><li><a href="/month/1393-12/" title="All posts from 1393-12">1393-12</a> (1)</li><li><a href="/month/1393-07/" title="All posts from 1393-07">1393-07</a> (1)</li><li><a href="/month/1393-06/" title="All posts from 1393-06">1393-06</a> (2)</li><li><a href="/month/1393-05/" title="All posts from 1393-05">1393-05</a> (2)</li><li><a href="/month/1393-04/" title="All posts from 1393-04">1393-04</a> (4)</li><li><a href="/month/1393-03/" title="All posts from 1393-03">1393-03</a> (5)</li><li><a href="/month/1393-02/" title="All posts from 1393-02">1393-02</a> (1)</li><li><a href="/month/1393-01/" title="All posts from 1393-01">1393-01</a> (4)</li><li><a href="/month/1392-12/" title="All posts from 1392-12">1392-12</a> (5)</li><li><a href="/month/1392-10/" title="All posts from 1392-10">1392-10</a> (5)</li><li><a href="/month/1392-06/" title="All posts from 1392-06">1392-06</a> (1)</li><li><a href="/month/1392-04/" title="All posts from 1392-04">1392-04</a> (1)</li><li><a href="/month/1392-02/" title="All posts from 1392-02">1392-02</a> (1)</li><li><a href="/month/1392-01/" title="All posts from 1392-01">1392-01</a> (5)</li><li><a href="/month/1391-11/" title="All posts from 1391-11">1391-11</a> (5)</li><li><a href="/month/1391-10/" title="All posts from 1391-10">1391-10</a> (4)</li><li><a href="/month/1391-09/" title="All posts from 1391-09">1391-09</a> (2)</li><li><a href="/month/1391-08/" title="All posts from 1391-08">1391-08</a> (3)</li><li><a href="/month/1391-07/" title="All posts from 1391-07">1391-07</a> (6)</li><li><a href="/month/1391-05/" title="All posts from 1391-05">1391-05</a> (1)</li><li><a href="/month/1391-04/" title="All posts from 1391-04">1391-04</a> (1)</li><li><a href="/month/1391-03/" title="All posts from 1391-03">1391-03</a> (2)</li><li><a href="/month/1391-02/" title="All posts from 1391-02">1391-02</a> (4)</li><li><a href="/month/1391-01/" title="All posts from 1391-01">1391-01</a> (6)</li><li><a href="/month/1390-12/" title="All posts from 1390-12">1390-12</a> (9)</li><li><a href="/month/1390-11/" title="All posts from 1390-11">1390-11</a> (8)</li><li><a href="/month/1390-10/" title="All posts from 1390-10">1390-10</a> (7)</li><li><a href="/month/1390-09/" title="All posts from 1390-09">1390-09</a> (4)</li><li><a href="/month/1390-08/" title="All posts from 1390-08">1390-08</a> (7)</li><li><a href="/month/1390-07/" title="All posts from 1390-07">1390-07</a> (14)</li><li><a href="/month/1390-06/" title="All posts from 1390-06">1390-06</a> (18)</li></ul></aside></div></div><footer id="footer-wrapper"><div id="footer-bottom-wrapper"><div class="container"><div class="row"><div class="col-12"><p dir="ltr">&copy; Copyright 2011-2022 * Ahmad Hejazee * All rights reserved.</p><small dir="ltr">Proudly Powered by Drupal 10 ;)</small></div></div></div></div></footer><script src="/lib/jQuery/jquery-3.6.0.min.js"></script>
<script src="/lib/bootstrap-5.1.3-dist/js/bootstrap.bundle.min.js"></script></body></html>